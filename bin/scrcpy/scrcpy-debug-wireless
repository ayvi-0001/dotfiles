#!/usr/bin/env bash

set -euo pipefail

if [[ -z "$*" ]]; then
  DEVICE=$(gum choose < <(tailscale status | tr -s ' ' | cut -d' ' -f2))
  HOST=$(tailscale status | rg "$DEVICE" | cut -d' ' -f1)
else
  HOST="$*"
fi  

adb tcpip 5555 || true
adb connect "$HOST" || true

scrcpy \
  --select-tcpip \
  --legacy-paste \
  --keyboard=uhid \
  --max-fps=60 \
  --no-audio \
  --max-size=1920 \
  --shortcut-mod=lsuper \
  --video-codec=h265 \
  "$@"

exit $?
